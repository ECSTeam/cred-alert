---
name: revok

description: |
  Revok clones all GitHub repositories accessible with the provided API token
  and SSH key and scans them for credentials.

templates:
  ctl.erb: bin/ctl
  pre-start.erb: bin/pre-start
  github_private_key.erb: config/github_private_key
  github_public_key.erb: config/github_public_key
  pubsub_public_key.erb: config/pubsub_public_key
  rpc_server_client_ca.erb: config/rpc_server_client_ca
  rpc_server_private_key.erb: config/rpc_server_private_key
  rpc_server_cert.erb: config/rpc_server_cert

packages:
- cred-alert
- golang
- git
- libgit2
- libssh2
- pid_utils_revok

properties:
  revok.pubsub.project_name:
    description: |
      The name of the project that includes the subscription which we are pulling messages from to.

  revok.pubsub.fetch_hint.subscription:
    description: |
      The subscription to recieve messages from about fetch hints.

  revok.pubsub.public_key:
    description: |
      PEM-encoded, unencrypted RSA public key used to sign messages

  revok.repository_discovery_interval:
    description: |
      The interval, in Go duration format (e.g. 1m = 1 minute), on which to
      query GitHub for repositories. Setting this value to a multiple of the
      minimum_fetch_interval can cause some repositories to be fetched half
      as frequently.
    default: 1h

  revok.change_discovery_interval:
    description: |
      The interval, in Go duration format (e.g. 1m = 1 minute), on which to
      query Git repositories on disk for changes.
    default: 1h

  revok.minimum_fetch_interval:
    description: |
      The minimum interval, in Go duration format (e.g. 1m = 1 minute), on which to
      fetch a Git repository
    default: 6h

  revok.maximum_fetch_interval:
    description: |
      The maximum interval, in Go duration format (e.g. 1m = 1 minute), on which to
      fetch a Git repository
    default: 168h

  revok.credential_counter_interval:
    description: |
      The interval, in Go duration format (e.g. 1m = 1 minute), on which to
      update the count of credentials found at the tip of each branch in all
      repositories.
    default: 24h

  revok.ignore_patterns:
    description: |
      List regexes to match against repo names to ignore. The names may be
      regex patterns.

  revok.work_dir:
    description: |
      Directory where repositories will be cloned to and scanned in.

  revok.github.private_key:
    description: |
      GitHub private key.

  revok.github.public_key:
    description: |
      GitHub public key.

  revok.github.access_token:
    description: |
      GitHub access token.

  revok.mysql.username:
    description: |
      Username to use for connecting to MySQL.

  revok.mysql.password:
    description: |
      Password to use for connecting to MySQL. (Optional)

  revok.mysql.hostname:
    description: |
      The hostname to use for connecting to MySQL.
    default: revok

  revok.mysql.port:
    description: |
      Port to use for connecting to MySQL.
    default: 3306

  revok.mysql.db:
    description: |
      The name of the database to use.
    default: revok

  revok.rpc_server.bind_ip:
    description: |
      IP address on which to listen for RPC traffic.
    default: 0.0.0.0

  revok.rpc_server.bind_port:
    description: |
      Port on which to listen for RPC traffic.
    default: 50051

  revok.rpc_server.client_ca:
    description: |
      RPC client CA certificate

  revok.rpc_server.cert:
    description: |
      RPC server certificate

  revok.rpc_server.private_key:
    description: |
      RPC server private key

  revok.metrics.datadog_api_key:
    description: |
      Datadog API key

  revok.metrics.sentry_dsn:
    description: |
      Sentry DSN

  revok.metrics.environment:
    description: |
      Environment tag for metrics

  revok.slack_webhook_url:
    description: |
      Slack webhook URL
