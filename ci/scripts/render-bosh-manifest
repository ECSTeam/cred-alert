#!/usr/bin/env bash

set -e

cat > credentials.yml <<EOF
revok-github-access-token: $GITHUB_ACCESS_TOKEN

revok-mysql-username: $MYSQL_USERNAME
revok-mysql-password: $MYSQL_PASSWORD
revok-mysql-hostname: $MYSQL_HOSTNAME

revok-datadog-api-key: $DATADOG_API_KEY
revok-sentry-dsn: $SENTRY_DSN

revok-papertrail-address: $PAPERTRAIL_ADDRESS
revok-slack-webhook-url: $SLACK_WEBHOOK_URL
revok-ignore-repos: $IGNORE_REPOS
EOF

IFS=$'\n'
echo "revok-github-private-key: |" >> credentials.yml
for line in $GITHUB_PRIVATE_KEY; do
  echo "  $line" >> credentials.yml
done

echo "revok-github-public-key: |" >> credentials.yml
for line in $GITHUB_PUBLIC_KEY; do
  echo "  $line" >> credentials.yml
done

bosh-cli build-manifest $MANIFEST_PATH -l credentials.yml > manifest/manifest.yml
